<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pull Down Spinner</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
                "Segoe UI Symbol";
            margin: 0;
            background-color: #f0f2f5;
            color: #333;
            /* Prevents the browser's default pull-to-refresh or overscroll glow */
            overscroll-behavior-y: contain;
            min-height: 100vh;
        }

        #spinner-container {
            position: fixed; /* Use fixed positioning to stay on top */
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            /* Initially hidden above the viewport */
            transform: translateY(-100%);
            z-index: 10;
        }

        #spinner {
            width: 30px;
            height: 30px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top-color: #09f;
            border-radius: 50%;
        }

        .content {
            text-align: center;
            padding: 20px;
            padding-top: 80px; /* Space for the spinner area */
        }

        h1 {
            color: #1c1e21;
        }

        p {
            font-size: 1.1em;
            line-height: 1.6;
            color: #606770;
            max-width: 600px;
            margin: 1em auto;
        }
    </style>
</head>
<body>

    <div id="spinner-container">
        <div id="spinner"></div>
    </div>

    <div class="content">
        <h1>Pull Down to See the Spinner</h1>
        <p>Touch and drag down anywhere on the page when you are at the very top.</p>
        <p>If you scroll down, the pull-to-refresh gesture will be disabled, allowing for normal page scrolling. Scroll back to the top to re-enable it!</p>
        <p style="font-size: 8rem; margin: 40px 0; opacity: 0.1;">&#x2193;</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius a, semper congue, euismod non, mi. Proin porttitor, orci nec nonummy molestie, enim est eleifend mi, non fermentum diam nisl sit amet erat. Duis semper. Duis arcu massa, scelerisque vitae, consequat in, pretium a, enim. Pellentesque congue. Ut in risus volutpat libero pharetra tempor. Cras vestibulum bibendum augue. Praesent egestas leo in pede. Praesent blandit odio eu enim. Pellentesque sed dui ut augue blandit sodales. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam nibh.</p>
        <p>Curabitur ligula sapien, pulvinar a vestibulum quis, facilisis vel sapien. Sed vel lectus. Donec odio tempus molestie, porttitor ut, iaculis quis, sem. Phasellus rhoncus. Aenean id metus id velit ullamcorper pulvinar. Vestibulum fermentum tortor id mi. Pellentesque ipsum. Nulla ac enim. In tempor, turpis nec euismod scelerisque, quam turpis adipiscing lorem, vitae mattis nibh ligula nec sem. Duis aliquam convallis nunc. Proin magna. In hac habitasse platea dictumst. Praesent elementum. Fusce wisi. Nam nonummy. In in velit quis lectus viverra rhoncus. </p>
        <p>Donec et nisl. Nulla quis ante. Aliquam erat volutpat. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos hymenaeos. Cras pede libero, dapibus nec, pretium sit amet, tempor quis. Etiam neque. Vivamus consequat lorem at magna. Nullam nonummy. Sed commodo, magna quis lacinia ornare, quam ante aliquam nisi, eu iaculis leo purus venenatis dui. </p>
    </div>

    <script>
        const spinnerContainer = document.getElementById('spinner-container');
        const spinner = document.getElementById('spinner');
        const body = document.body;

        let isDragging = false;
        let startY = 0;

        body.addEventListener('touchstart', (e) => {
            // Just record the starting Y position of the touch.
            // We'll decide whether to start the drag in touchmove.
            if (isDragging) return;
            startY = e.touches[0].clientY;
        }, { passive: true });

        body.addEventListener('touchmove', (e) => {
            const currentY = e.touches[0].clientY;
            const pullDistance = currentY - startY;

            // Activate the drag only if we are at the top of the page and pulling down.
            if (window.scrollY === 0 && pullDistance > 0 && !isDragging) {
                isDragging = true;
                // Disable CSS transitions for direct 1:1 manipulation while dragging.
                spinnerContainer.style.transition = 'none';
                spinner.style.transition = 'none';
            }

            if (isDragging) {
                // Prevent the browser's native scroll behavior (and pull-to-refresh).
                e.preventDefault();

                // A damping factor to make the pull feel more natural (less than 1:1).
                const dampenedPull = pullDistance * 0.4;
                
                // We only want to show the spinner when pulling down.
                const displayPull = Math.max(0, dampenedPull);

                // Move the spinner container down from its hidden position.
                spinnerContainer.style.transform = `translateY(calc(-100% + ${displayPull}px))`;

                // Rotate the spinner icon based on the pull distance.
                const rotation = pullDistance * 2; // 2 degrees per pixel
                spinner.style.transform = `rotate(${rotation}deg)`;
            }
        }, { passive: false }); // passive: false is required to use preventDefault().

        const endDrag = () => {
            if (!isDragging) return;
            
            isDragging = false;

            // Re-enable transitions for a smooth animation back to the top.
            spinnerContainer.style.transition = 'transform 0.3s ease-out';
            spinner.style.transition = 'transform 0.3s ease-out';

            // Animate the spinner back to its original hidden position.
            spinnerContainer.style.transform = 'translateY(-100%)';
            spinner.style.transform = 'rotate(0deg)';
        };

        body.addEventListener('touchend', endDrag);
        body.addEventListener('touchcancel', endDrag);

        function longRunningTask() {
            for(let i=0;i<300;i++) {
              console.log(`Task executed.`);
            }
        }

        const taskInterval = setInterval(longRunningTask, 20);

        setTimeout(() => {
          clearInterval(taskInterval);
          console.log('Task stopped after 100 seconds.');
        }, 100 * 1000);

            </script>
</body>
</html>
